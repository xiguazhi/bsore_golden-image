- name: Set Hostname on all hosts based on hosts inventory file
  hosts: all
  become: true
  vars:
    ansible_user: "{{ lookup('env', 'ANSIBLE_USER') }}"
    ansible_password: "{{ lookup('env', 'ANSIBLE_PASSWORD') }}"
    become_password: "{{ ansible_password }}"
  tasks:
  - name: Set hostname for each host
    ansible.builtin.hostname:
      name: "{{ inventory_hostname }}"
      use: systemd

- name: Configure DNS server on server
  hosts: dns_servers
  become: true
  vars:
    ANSIBLE_USER: "{{ lookup('env', 'ANSIBLE_USER') }}"
    ANSIBLE_PASSWORD: "{{ lookup('env', 'ANSIBLE_PASSWORD') }}"
    become_password: "{{ ansible_password }}"
    dns_servers:
    - 1.1.1.1
    - 1.0.0.1
    dns_domains:
    - bsorenson.io
  roles:
  - role: dns
    tags:
    - ever
    - dns
